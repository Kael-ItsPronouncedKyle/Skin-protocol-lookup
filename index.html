<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skin Protocol Lookup - Professional Esthetician Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary: #7C9885;
      --accent: #D4A574;
      --background: #FAF8F4;
      --warning: #C65D47;
      --contraindication: #DC2626;
      --text-dark: #2C3E30;
      --text-light: #5A6C57;
      --white: #FFFFFF;
      --shadow: rgba(124, 152, 133, 0.15);
      --shadow-hover: rgba(124, 152, 133, 0.25);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background);
      color: var(--text-dark);
      line-height: 1.6;
      padding-bottom: 80px;
    }

    h1, h2, h3, h4 {
      font-family: 'Playfair Display', serif;
      color: var(--text-dark);
    }

    /* Navigation */
    .nav-header {
      background: var(--white);
      box-shadow: 0 2px 12px var(--shadow);
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 1000;
    }

    .nav-tabs {
      display: flex;
      justify-content: space-around;
      max-width: 800px;
      margin: 0 auto;
      padding: 0;
    }

    .nav-tab {
      flex: 1;
      padding: 16px 8px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-light);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .nav-tab .icon { font-size: 20px; }

    .nav-tab.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      font-weight: 600;
    }

    .nav-tab:hover { background: var(--background); }

    /* Container */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 80px 16px 16px;
    }

    .page { display: none; }
    .page.active { display: block; }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Inter', sans-serif;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background: #6A8573;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px var(--shadow-hover);
    }

    .btn-secondary { background: var(--accent); }
    .btn-secondary:hover { background: #C29563; }

    .btn-danger { background: var(--warning); }
    .btn-danger:hover { background: #B34D37; }

    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      min-height: 36px;
    }

    /* Condition Selector */
    .condition-selector {
      background: var(--white);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 2px 12px var(--shadow);
      margin-bottom: 24px;
    }

    .condition-selector h2 {
      margin-bottom: 16px;
      font-size: 24px;
    }

    .condition-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .condition-checkbox { position: relative; }

    .condition-checkbox input[type="checkbox"] {
      position: absolute;
      opacity: 0;
    }

    .condition-checkbox label {
      display: block;
      padding: 12px 16px;
      background: var(--background);
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .condition-checkbox input:checked + label {
      background: var(--primary);
      color: var(--white);
      border-color: var(--primary);
      transform: scale(1.02);
    }

    .condition-checkbox label:hover { border-color: var(--primary); }

    /* Protocol Cards */
    .protocol-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .protocol-card {
      background: var(--white);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 12px var(--shadow);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }

    .protocol-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px var(--shadow-hover);
    }

    .protocol-card h3 {
      font-size: 20px;
      margin-bottom: 12px;
      color: var(--primary);
      padding-right: 34px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      margin: 4px 4px 4px 0;
    }

    .badge-match { background: var(--primary); color: var(--white); }

    .badge-condition { background: var(--background); color: var(--text-dark); }
    .badge-condition.matched { background: var(--accent); color: var(--white); }

    .badge-contraindication { background: var(--contraindication); color: var(--white); }

    .favorite-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 4px;
      line-height: 1;
    }

    .favorite-btn.favorited { animation: heartBeat 0.3s ease; }

    @keyframes heartBeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    /* Protocol Detail */
    .protocol-detail {
      background: var(--white);
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 2px 12px var(--shadow);
      margin-bottom: 24px;
    }

    .protocol-detail h1 {
      font-size: 32px;
      color: var(--primary);
      margin-bottom: 24px;
    }

    .detail-section { margin-bottom: 32px; }

    .detail-section h2 {
      font-size: 24px;
      margin-bottom: 16px;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .detail-section h3 {
      font-size: 18px;
      margin-bottom: 12px;
      color: var(--primary);
    }

    /* Contraindication Alert */
    .contraindication-alert {
      background: #FEE2E2;
      border: 2px solid var(--contraindication);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: start;
      gap: 16px;
    }

    .contraindication-alert .icon {
      font-size: 32px;
      color: var(--contraindication);
      flex-shrink: 0;
    }

    .contraindication-alert h2 {
      color: var(--contraindication);
      font-size: 20px;
      margin-bottom: 8px;
    }

    .contraindication-alert ul {
      margin-left: 20px;
      color: var(--contraindication);
      font-weight: 500;
    }

    /* Warning Alert */
    .warning-alert {
      background: #FFF7ED;
      border: 2px solid var(--warning);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      display: flex;
      align-items: start;
      gap: 16px;
    }

    .warning-alert .icon {
      font-size: 32px;
      color: var(--warning);
      flex-shrink: 0;
    }

    .warning-alert h2 {
      color: var(--warning);
      font-size: 20px;
      margin-bottom: 8px;
    }

    .warning-alert ul { margin-left: 20px; }

    /* Ingredient Grid */
    .ingredient-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }

    .ingredient-category { margin-bottom: 20px; }

    .ingredient-category h4 {
      font-size: 16px;
      color: var(--primary);
      margin-bottom: 12px;
    }

    .ingredient-item {
      background: var(--background);
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 14px;
      border: 1px solid #E5E5E5;
    }

    /* Steps List */
    .steps-list { counter-reset: step-counter; list-style: none; }

    .steps-list li {
      counter-increment: step-counter;
      position: relative;
      padding-left: 48px;
      margin-bottom: 16px;
      line-height: 1.6;
    }

    .steps-list li::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      top: 0;
      width: 32px;
      height: 32px;
      background: var(--primary);
      color: var(--white);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    /* Home Care Grid */
    .homecare-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 24px;
    }

    .homecare-section {
      background: var(--background);
      padding: 20px;
      border-radius: 12px;
    }

    .homecare-section h3 { margin-bottom: 16px; }
    .homecare-section ul { list-style: none; }
    .homecare-section li { padding: 8px 0; border-bottom: 1px solid #E5E5E5; }
    .homecare-section li:last-child { border-bottom: none; }

    /* Filters */
    .filter-message {
      background: #DBEAFE;
      border-left: 4px solid #3B82F6;
      padding: 16px;
      border-radius: 8px;
      margin-top: 24px;
      font-size: 14px;
      color: #1E40AF;
    }

    /* Dropdown */
    .dropdown-container { margin-bottom: 24px; }

    .dropdown-container label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-dark);
    }

    select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #E5E5E5;
      border-radius: 8px;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      background: var(--white);
      cursor: pointer;
      min-height: 48px;
    }

    select:focus { outline: none; border-color: var(--primary); }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }

    .empty-state .icon {
      font-size: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 20px;
      margin-bottom: 8px;
      color: var(--text-light);
    }

    /* Sort Controls */
    .sort-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
    }

    .sort-controls label { font-weight: 600; color: var(--text-dark); }

    /* Client Handout Styling */
    .client-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .client-meta .field {
      background: var(--background);
      border: 1px solid #E5E5E5;
      border-radius: 10px;
      padding: 12px;
      min-height: 54px;
    }
    .client-meta .label {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 4px;
      font-weight: 600;
    }
    .client-meta .value {
      font-size: 14px;
      color: var(--text-dark);
    }

    /* Print Styles */
    @media print {
      body { background: white; padding: 0; }

      .nav-header,
      .btn,
      .favorite-btn,
      .no-print,
      .toast {
        display: none !important;
      }

      .container { padding: 0; max-width: 100%; }

      .protocol-detail { box-shadow: none; page-break-inside: avoid; }
      .detail-section { page-break-inside: avoid; }

      .protocol-card {
        page-break-inside: avoid;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 12px;
      }

      h1 { font-size: 24pt; }
      h2 { font-size: 18pt; }
      h3 { font-size: 14pt; }
      body { font-size: 11pt; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .condition-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); }
      .protocol-grid { grid-template-columns: 1fr; }
      .protocol-detail { padding: 20px; }
      .protocol-detail h1 { font-size: 24px; }
      .homecare-grid { grid-template-columns: 1fr; }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--text-dark);
      color: var(--white);
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="nav-header">
    <div class="nav-tabs">
      <button class="nav-tab active" data-page="find">
        <span class="icon">üè†</span>
        <span>Find Protocol</span>
      </button>
      <button class="nav-tab" data-page="library">
        <span class="icon">üìö</span>
        <span>Library</span>
      </button>
      <button class="nav-tab" data-page="ingredients">
        <span class="icon">üîç</span>
        <span>Ingredients</span>
      </button>
      <button class="nav-tab" data-page="favorites">
        <span class="icon">‚≠ê</span>
        <span>Favorites</span>
      </button>
    </div>
  </nav>

  <div class="container">
    <!-- Find Protocol Page -->
    <div id="findPage" class="page active">
      <div class="condition-selector">
        <h2>Select Skin Conditions</h2>
        <div class="condition-grid" id="conditionGrid"></div>
        <button class="btn btn-small" onclick="clearAllConditions()">Clear All</button>
      </div>

      <div id="findResults"></div>
    </div>

    <!-- Library Page -->
    <div id="libraryPage" class="page">
      <div style="background: var(--white); padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px var(--shadow); margin-bottom: 24px;">
        <h2 style="margin-bottom: 16px;">Protocol Reference Library</h2>
        <div class="sort-controls">
          <label>Sort by:</label>
          <button class="btn btn-small" onclick="sortLibrary('name')">Name</button>
          <button class="btn btn-small" onclick="sortLibrary('conditions')">Conditions Count</button>
        </div>
        <p style="color: var(--text-light); font-size: 13px;">
          Note: Protocols tagged <strong>All Skin Types</strong> only appear when <strong>All Skin Types</strong> is selected in Find Protocol.
        </p>
      </div>
      <div id="libraryGrid" class="protocol-grid"></div>
    </div>

    <!-- Ingredients Page -->
    <div id="ingredientsPage" class="page">
      <div style="background: var(--white); padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px var(--shadow); margin-bottom: 24px;">
        <h2 style="margin-bottom: 16px;">Search by Ingredient</h2>
        <div class="dropdown-container">
          <label for="ingredientSelect">Select an ingredient:</label>
          <select id="ingredientSelect" onchange="filterByIngredient()">
            <option value="">‚Äì Select an ingredient ‚Äì</option>
          </select>
        </div>
      </div>
      <div id="ingredientResults"></div>
    </div>

    <!-- Favorites Page -->
    <div id="favoritesPage" class="page">
      <div style="background: var(--white); padding: 24px; border-radius: 12px; box-shadow: 0 2px 12px var(--shadow); margin-bottom: 24px;">
        <h2>Favorite Protocols</h2>
      </div>
      <div id="favoritesGrid" class="protocol-grid"></div>
    </div>

    <!-- Protocol Detail View (Hidden by default) -->
    <div id="detailPage" class="page"></div>

    <!-- Client Output View (Hidden by default) -->
    <div id="clientPage" class="page"></div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script>
    // ============================================================
    // EMBEDDED PROTOCOL DATA
    // Edit this JSON directly in this HTML file to update protocols.
    // ============================================================
    const EMBEDDED_PROTOCOLS = [
      {
        "id": "coconut-papaya",
        "name": "Coconut Papaya Facial Protocol",
        "skinConditions": ["All Skin Types", "Rosacea/Sensitive", "Acne"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Toner.",
          "Perform a Skin Analysis.",
          "Apply the Coconut Papaya Enzyme with a Skin Script Fan Brush in an even layer over the face.",
          "Optional: After applying the enzyme, put the client under steam for 7-10 minutes.",
          "Remove with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1-2 pumps of Citrus-C Nourishing Cream to the face.",
          "Apply Seaweed Mask or Goji Berry Yogurt Mask with a Skin Script Fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream along the orbital bone.",
          "Moisturize with Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate very gently with Retinol 2% Exfoliating Scrub/Mask (2-3 times per week).",
            "Apply Cucumber Hydration Toner.",
            "Apply Acai Berry Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Hydration Toner.",
            "Apply Citrus-C Nourishing Cream.",
            "Apply Acai Berry Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Cucumber Hydration Toner",
          "Coconut Papaya Enzyme",
          "Citrus-C Nourishing Cream",
          "Seaweed Mask",
          "Goji Berry Yogurt Mask",
          "Tri-Peptide Eye Cream",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub"
        ],
        "warnings": []
      },
      {
        "id": "pineapple",
        "name": "Pineapple Facial Protocol",
        "skinConditions": ["All Skin Types", "Anti-Aging", "Hyperpigmentation"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Green Tea Citrus Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Hydration Toner.",
          "Perform a Skin Analysis.",
          "Apply Pineapple Enzyme with a Skin Script Fan Brush in an even layer over face.",
          "Optional: After applying the enzyme, put the client under steam for 7-10 minutes.",
          "Remove Pineapple Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1-2 pumps of Citrus-C Nourishing Cream to the face.",
          "Apply Golden Honey Nourishing Mask with hands evenly over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream along the orbital bone.",
          "Moisturize with one pump of Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate gently with Retinol 2% Exfoliating Scrub/Mask (2-3 times per week).",
            "Apply Cucumber Hydration Toner.",
            "Apply Acai Berry Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Hydration Toner.",
            "Apply Citrus-C Nourishing Cream.",
            "Apply Acai Berry Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Honey Brightening Cleanser",
          "Cucumber Hydration Toner",
          "Pineapple Enzyme",
          "Citrus-C Nourishing Cream",
          "Golden Honey Nourishing Mask",
          "Tri-Peptide Eye Cream",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub"
        ],
        "warnings": []
      },
      {
        "id": "lemon-zest",
        "name": "Lemon Zest Facial Protocol",
        "skinConditions": ["Normal", "Dry", "Mature", "Anti-Aging", "Hyperpigmentation", "Sun Damage", "Melasma"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Green Tea Citrus Cleanser or Pomegranate Antioxidant Cleanser; remove with esthetic wipes, sponges or steam towel.",
          "Second cleanse with Glycolic Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges or steam towel.",
          "Tone with Cucumber Hydration Toner.",
          "Perform a Skin Analysis.",
          "Apply Lemon Zest Enzyme with a Skin Script Fan Brush in an even layer over the face.",
          "Optional: Place client under steam for 7-10 minutes.",
          "Advanced Power Facial Protocol: To boost this enzyme treatment, mix in half a teaspoon of 20% Lactic Lightening Peel for extra exfoliation, hydration and lightening benefits. (Can cause skin to be flaky for 3-4 days)",
          "Remove Lemon Zest Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Layer one pump of Ageless Hydrating Serum with one pump of Citrus-C Nourishing Cream to the face.",
          "Apply Golden Honey Mask with hands or Goji Berry Yogurt Mask with Skin Script Fan Brush in an even layer over the face for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Toner or tone with a Glycolic & Retinol Pad all over or to targeted areas.",
          "Apply one pump Tri-Peptide Eye Cream along the orbital bone.",
          "Moisturize with Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Cleanse with Glycolic Cleanser (2-3 times per week).",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Apply Acai Berry Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Glycolic & Retinol Pads.",
            "Apply Citrus-C Nourishing Cream or Mandelic Brightening Serum.",
            "Apply Acai Berry Moisturizer."
          ]
        },
        "ingredients": [
          "Green Tea Citrus Cleanser",
          "Pomegranate Antioxidant Cleanser",
          "Glycolic Cleanser",
          "Cucumber Hydration Toner",
          "Lemon Zest Enzyme",
          "20% Lactic Lightening Peel",
          "Ageless Hydrating Serum",
          "Citrus-C Nourishing Cream",
          "Golden Honey Nourishing Mask",
          "Goji Berry Yogurt Mask",
          "Glycolic & Retinol Pad",
          "Tri-Peptide Eye Cream",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub",
          "Mandelic Brightening Serum"
        ],
        "warnings": ["Advanced Power Facial Protocol may cause skin to be flaky for 3-4 days."]
      },
      {
        "id": "cherry",
        "name": "Cherry Facial Protocol",
        "skinConditions": ["Normal", "Combination", "Acne", "Anti-Aging", "Hyperpigmentation"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Green Tea Citrus Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Toner.",
          "Perform a Skin Analysis.",
          "Apply Cherry Enzyme with a Skin Script Fan Brush in an even layer over the face and use with or without steam for 7-10 minutes.",
          "Advanced Power Facial Protocol: mix ¬Ω tsp of lactic or glycolic peel for enhanced exfoliation and brightening. For sensitive clients, blend enzyme with 1 part Goji Berry mask and 1 part enzyme to buffer.",
          "Remove Cherry Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1-2 pumps of Citrus-C Nourishing Cream or Vitamin C Green Tea Serum to the face.",
          "Apply Goji Berry Yogurt Mask with Skin Script fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream or Peptide Eye Serum along the orbital bone.",
          "Moisturize with Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Cleanse with Glycolic Cleanser (2-3 times per week).",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Apply Cucumber Hydration Toner.",
            "Apply Acai Berry Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Spot treat with Glycolic & Retinol Pads (2-3 per week).",
            "Apply Acai Berry Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Honey Brightening Cleanser",
          "Cucumber Hydration Toner",
          "Cherry Enzyme",
          "Lactic Peel",
          "Glycolic Peel",
          "Goji Berry Yogurt Mask",
          "Citrus-C Nourishing Cream",
          "Vitamin C Green Tea Serum",
          "Tri-Peptide Eye Cream",
          "Peptide Eye Serum",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Glycolic Cleanser",
          "Retinol 2% Exfoliating Scrub",
          "Glycolic & Retinol Pads"
        ],
        "warnings": []
      },
      {
        "id": "pomegranate",
        "name": "Pomegranate Facial Protocol",
        "skinConditions": ["Normal", "Oily", "Combination", "Acne", "Sun Damage", "Hyperpigmentation", "Melasma"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Raspberry Refining Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Mint Refining Toner or Cucumber Hydration Toner.",
          "Perform a Skin Analysis.",
          "Apply Pomegranate Enzyme with a Skin Script Fan Brush in an even layer over the face and use with or without steam for 7-10 minutes.",
          "Remove Pomegranate Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1-2 pumps of Vitamin C Green Tea Serum to the face.",
          "Apply Strawberry Spearmint Mask with Skin Script Fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Mint Refining Toner or Cucumber Hydration Toner.",
          "Apply one pump Peptide Eye Serum along the orbital bone.",
          "Moisturize with Light Aloe Moisturizer or Ageless Skin Moisturizer.",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Cleanse with Glycolic Cleanser (2-3 times per week).",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Apply Light Aloe Moisturizer or Ageless Skin Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Glycolic & Retinol Pads.",
            "Apply Vitamin C Green Tea Serum or Mandelic Brightening Serum.",
            "Apply Light Aloe Moisturizer or Ageless Skin Moisturizer."
          ]
        },
        "ingredients": [
          "Green Tea Citrus Cleanser",
          "Raspberry Refining Cleanser",
          "Honey Brightening Cleanser",
          "Mint Refining Toner",
          "Cucumber Hydration Toner",
          "Pomegranate Enzyme",
          "Vitamin C Green Tea Serum",
          "Strawberry Spearmint Mask",
          "Peptide Eye Serum",
          "Light Aloe Moisturizer",
          "Ageless Skin Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Glycolic Cleanser",
          "Retinol 2% Exfoliating Scrub",
          "Glycolic & Retinol Pads",
          "Mandelic Brightening Serum"
        ],
        "warnings": []
      },
      {
        "id": "blueberry",
        "name": "Blueberry Facial Protocol",
        "skinConditions": ["Normal", "Oily", "Combination", "Acne", "Anti-Aging", "Pore Refinement"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Charcoal Clay Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Toner.",
          "Perform a Skin Analysis.",
          "Apply Blueberry Enzyme with a Skin Script Fan Brush in an even layer over the face with or without steam for 7-10 minutes.",
          "Optional: Apply a small amount 2% Retinol Scrub directly on impacted pores and steam for 1-2 minutes; do not remove. Then apply the Blueberry Enzyme on top of the scrub and manipulate it into the skin under steam.",
          "Remove Blueberry Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions as needed.",
          "Apply 1-2 pumps of Vitamin C Green Tea Serum to the face.",
          "Apply Charcoal Refining Mask with Skin Script Fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream or Peptide Eye Serum along the orbital bone.",
          "Moisturize with Lite Aloe Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Apply Cucumber Hydration Toner.",
            "Apply Light Aloe Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Hydration Toner.",
            "Apply Light Aloe Moisturizer."
          ]
        },
        "ingredients": [
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Charcoal Clay Cleanser",
          "Cucumber Hydration Toner",
          "Blueberry Enzyme",
          "2% Retinol Scrub",
          "Vitamin C Green Tea Serum",
          "Charcoal Refining Mask",
          "Tri-Peptide Eye Cream",
          "Peptide Eye Serum",
          "Light Aloe Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub"
        ],
        "warnings": []
      },
      {
        "id": "pumpkin-orange",
        "name": "15% Pumpkin Orange Facial Protocol",
        "skinConditions": ["Normal", "Combination", "Resilient", "Anti-Aging", "Pore Refinement"],
        "contraindications": ["Rosacea/Sensitive"],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Toner.",
          "Perform a Skin Analysis.",
          "Apply Pumpkin Orange Enzyme with a Skin Script Fan Brush in an even layer over the face. DO NOT USE STEAM. Leave on the skin for 7-10 minutes.",
          "Remove Pumpkin Orange Enzyme with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1 pump of Ageless Skin Hydrating Serum mixed with 1 pump of Vitamin C Green Tea Serum to the face.",
          "Apply Goji Berry Yogurt Mask with Skin Script fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream or Peptide Eye Serum along the orbital bone.",
          "Moisturize with Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Tone with Cucumber Hydration Toner.",
            "Apply Hydrating Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Spot treat with Glycolic & Retinol Pads (2-3 times per week).",
            "Apply Hydrating Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Honey Brightening Cleanser",
          "Cucumber Hydration Toner",
          "Pumpkin Orange Enzyme",
          "Ageless Skin Hydrating Serum",
          "Vitamin C Green Tea Serum",
          "Goji Berry Yogurt Mask",
          "Tri-Peptide Eye Cream",
          "Peptide Eye Serum",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub",
          "Glycolic & Retinol Pads",
          "Hydrating Moisturizer"
        ],
        "warnings": ["MAY CAUSE PEELING OR FLAKING", "DO NOT USE STEAM"]
      },
      {
        "id": "pumpkin-cheesecake",
        "name": "Pumpkin Cheesecake Facial Protocol",
        "skinConditions": ["Normal", "Combination", "Anti-Aging"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Toner.",
          "Perform a Skin Analysis.",
          "Mix one part 15% Pumpkin Orange Enzyme and one part Goji Berry Yogurt Mask together in a dish. Apply Pumpkin/Goji mixture to the face in an even layer with a Skin Script fan brush and leave on the skin for 7-10 minutes DO NOT USE STEAM.",
          "Remove Pumpkin/Goji mixture with a warm steam towel or with cool aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1 pump of Ageless Skin Hydrating Serum mixed with 1 pump of Vitamin C Green Tea Serum to the face.",
          "Apply Goji Berry Yogurt Mask with Skin Script fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply one pump Tri-Peptide Eye Cream or Peptide Eye Serum along the orbital bone.",
          "Moisturize with Acai Berry Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Tone with Cucumber Hydration Toner.",
            "Apply Ageless Skin Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Spot treat with Glycolic & Retinol Pads.",
            "Tone with Cucumber Hydration Toner.",
            "Apply Ageless Skin Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Honey Brightening Cleanser",
          "Cucumber Hydration Toner",
          "15% Pumpkin Orange Enzyme",
          "Goji Berry Yogurt Mask",
          "Ageless Skin Hydrating Serum",
          "Vitamin C Green Tea Serum",
          "Tri-Peptide Eye Cream",
          "Peptide Eye Serum",
          "Acai Berry Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub",
          "Glycolic & Retinol Pads",
          "Ageless Skin Moisturizer"
        ],
        "warnings": []
      },
      {
        "id": "passionfruit",
        "name": "Passionfruit Facial Protocol",
        "skinConditions": ["Firming"],
        "contraindications": ["Rosacea/Sensitive", "Melasma", "Hyperpigmentation"],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Green Tea Citrus Cleanser or Glycolic Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Tone with Cucumber Hydration Toner.",
          "Perform a Skin Analysis.",
          "Apply the Passionfruit Enzyme with Skin Script Fan Brush in an even layer over the face (suggest NO STEAM for first time) for 7-10 minutes; it is normal for the skin to appear red and warm.",
          "Remove Passionfruit Enzyme with a warm steam towel or with aesthetic wipes.",
          "Perform extractions if needed.",
          "Apply 1-2 pumps of Citrus-C Nourishing Cream to the face.",
          "Apply Goji Berry Yogurt Mask with Skin Script fan Brush in an even layer over the face and leave on for up to 10 minutes and remove with warm steam towel.",
          "Mist with Cucumber Hydration Toner.",
          "Apply only one pump Tri-Peptide Eye Cream along the orbital bone.",
          "Moisturize with one pump of Peptide Restoration Moisturizer (or appropriate moisturizer).",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed.",
          "Apply a small amount of Ageless Lip Treatment to the lips."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate gently with Retinol 2% Exfoliating Scrub/Mask (2-3 times per week).",
            "Apply Cucumber Hydration Toner.",
            "Apply Peptide Restoration Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Hydration Toner.",
            "Apply Citrus-C Nourishing Cream.",
            "Apply Peptide Restoration Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Cucumber Hydration Toner",
          "Passionfruit Enzyme",
          "Citrus-C Nourishing Cream",
          "Goji Berry Yogurt Mask",
          "Tri-Peptide Eye Cream",
          "Peptide Restoration Moisturizer",
          "Sheer Protection SPF 30",
          "Ageless Lip Treatment",
          "Retinol 2% Exfoliating Scrub"
        ],
        "warnings": [
          "Because this enzyme creates dermal warmth, it is not recommended for rosacea, couperose, sensitive skin, pregnancy, clients with melasma, existing hyperpigmentation or untreated Fitzpatricks 3-6.",
          "No steam for first time application"
        ]
      },
      {
        "id": "lactic-lightening",
        "name": "20% Lactic Lightening Peel Protocol",
        "skinConditions": ["All Skin Types", "Hyperpigmentation", "Melasma"],
        "contraindications": [],
        "professionalSteps": [
          "First cleanse with Pomegranate Antioxidant Cleanser or Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Honey Brightening Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Perform a Skin Analysis.",
          "Degrease skin with a Glycolic & Retinol Pad using medium-firm pressure to remove surface oils and provide additional brightening benefits.",
          "Occlude any areas such as recent extractions and lips with petroleum jelly to prevent peel penetration in that area.",
          "Apply a generous amount of 20% Lactic Lightening Peel with a Skin Script Fan Brush or gauze over the face only. Leave on for 5-7 minutes. DO NOT LEAVE ON LONGER THAN 7 MINUTES.",
          "Completely remove and neutralize peel with Neutralization Solution (1 cup of water + 1 teaspoon of baking soda mixed in a bowl) with esthetic wipes.",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Pomegranate Cleanser.",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Tone with Cucumber Toner.",
            "Apply Citrus-C Nourishing Cream.",
            "Apply Hydrating Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Pomegranate Cleanser.",
            "Tone with Cucumber Hydration Toner.",
            "Apply Hydrating Moisturizer."
          ]
        },
        "ingredients": [
          "Pomegranate Antioxidant Cleanser",
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Honey Brightening Cleanser",
          "Glycolic & Retinol Pad",
          "20% Lactic Lightening Peel",
          "Neutralization Solution",
          "Sheer Protection SPF 30",
          "Pomegranate Cleanser",
          "Retinol 2% Exfoliating Scrub",
          "Cucumber Hydration Toner",
          "Citrus-C Nourishing Cream",
          "Hydrating Moisturizer"
        ],
        "warnings": [
          "Best performed in a series of 4-6 peels spaced one week apart",
          "DO NOT LEAVE ON LONGER THAN 7 MINUTES",
          "Your client will experience microscopic or mild flaking for 3-4 days"
        ]
      },
      {
        "id": "glycolic-peel",
        "name": "30% Glycolic Peel Protocol",
        "skinConditions": ["Acne", "Keratinized"],
        "contraindications": ["Rosacea/Sensitive", "Dry"],
        "professionalSteps": [
          "First cleanse with Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Raspberry Refining Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Perform a Skin Analysis.",
          "Degrease skin with a Glycolic & Retinol Pad using medium-firm pressure to remove surface oils and provide additional brightening benefits.",
          "Occlude any areas such as recent extractions and lips with petroleum jelly to prevent peel penetration in that area.",
          "Apply a generous amount of 30% Glycolic Peel with a Skin Script Fan Brush or gauze over the face only. Leave on for 5-7 minutes. DO NOT LEAVE ON LONGER THAN 7 MINUTES.",
          "Completely remove and neutralize peel with Neutralization Solution (1 cup of water + 1 teaspoon of baking soda mixed in a bowl) with esthetic wipes.",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Cleanse with Glycolic Cleanser (2-3 times per week).",
            "Apply Blemish Spot Treatment as needed.",
            "Apply Light Aloe Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Exfoliate with Retinol 2% Exfoliating Scrub (2-3 times per week).",
            "Apply Glycolic & Retinol Pads.",
            "Apply Light Aloe Moisturizer."
          ]
        },
        "ingredients": [
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Raspberry Refining Cleanser",
          "Glycolic & Retinol Pad",
          "30% Glycolic Peel",
          "Neutralization Solution",
          "Sheer Protection SPF 30",
          "Blemish Spot Treatment",
          "Light Aloe Moisturizer",
          "Retinol 2% Exfoliating Scrub",
          "Glycolic & Retinol Pads"
        ],
        "warnings": [
          "Best performed in a series of 4-6 peels spaced one week apart",
          "DO NOT LEAVE ON LONGER THAN 7 MINUTES",
          "Your client will experience microscopic or mild flaking for 3-4 days"
        ]
      },
      {
        "id": "cranberry-turnover",
        "name": "Cranberry Turnover Peel Protocol",
        "skinConditions": ["Oily", "Acne", "Pustular Acne"],
        "contraindications": ["Rosacea/Sensitive", "Dry"],
        "professionalSteps": [
          "First cleanse with Green Tea Citrus Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Second cleanse with Glycolic Cleanser or Raspberry Refining Cleanser; remove with esthetic wipes, sponges, or steam towel.",
          "Perform a Skin Analysis.",
          "Degrease skin with a Glycolic & Retinol Pad using medium-firm pressure to remove surface oils and provide additional brightening benefits.",
          "Occlude any areas such as recent extractions and lips with petroleum jelly to prevent peel penetration in that area.",
          "Apply a generous amount of the Cranberry Turnover Peel with a Skin Script Fan Brush or over the face only. Leave on for up to 10 minutes. This peel will be HOT!",
          "TIP: Can apply to section of the face or spot treat.",
          "Remove peel with esthetic wipes. Dry esthetic wipes first to remove majority of the cream and then continue to rinse skin with wet esthetic wipes until completely removed.",
          "Protect with Sheer Protection SPF 30; warm a blueberry size amount in fingertips, evenly distribute over face and lightly press and pat into the skin until absorbed."
        ],
        "homeCare": {
          "morning": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Toner.",
            "Apply Cacteen Balancing Moisturizer.",
            "Apply Sheer Protection SPF 30."
          ],
          "evening": [
            "Cleanse with Green Tea Citrus Cleanser.",
            "Apply Cucumber Toner.",
            "Apply Cacteen Balancing Moisturizer."
          ]
        },
        "ingredients": [
          "Green Tea Citrus Cleanser",
          "Glycolic Cleanser",
          "Raspberry Refining Cleanser",
          "Glycolic & Retinol Pad",
          "Cranberry Turnover Peel",
          "Sheer Protection SPF 30",
          "Cucumber Toner",
          "Cacteen Balancing Moisturizer"
        ],
        "warnings": [
          "Prepare Fitzpatricks 4-6 with tyrosinase inhibitors (Glycolic & Retinol Pads) for 1-2 weeks prior to use to avoid post-inflammatory hyperpigmentation.",
          "Your client will experience flaking for 3-4 days."
        ]
      }
    ];

    // ============================================
    // STATE MANAGEMENT
    // ============================================
    let protocols = [];
    let selectedConditions = [];
    let currentSort = 'name';

    const SKIN_CONDITIONS = [
      "All Skin Types", "Normal", "Dry", "Oily", "Combination",
      "Rosacea/Sensitive", "Acne", "Pustular Acne", "Mature",
      "Anti-Aging", "Firming", "Resilient", "Pore Refinement",
      "Sun Damage", "Hyperpigmentation", "Melasma", "Keratinized"
    ];

    // ============================================
    // INITIALIZATION
    // ============================================
    document.addEventListener('DOMContentLoaded', function () {
      protocols = validateAndNormalizeProtocols(EMBEDDED_PROTOCOLS);
      renderConditionGrid();
      setupNavigation();
      populateIngredientDropdown();
      renderLibrary();
      renderFavorites();
      renderFilteredProtocols();
    });

    function validateAndNormalizeProtocols(data) {
      if (!Array.isArray(data)) return [];
      const cleaned = [];

      data.forEach((p, i) => {
        if (!p || !p.id || !p.name) return;
        cleaned.push({
          id: String(p.id),
          name: String(p.name),
          skinConditions: Array.isArray(p.skinConditions) ? p.skinConditions : [],
          contraindications: Array.isArray(p.contraindications) ? p.contraindications : [],
          professionalSteps: Array.isArray(p.professionalSteps) ? p.professionalSteps : [],
          homeCare: {
            morning: Array.isArray(p.homeCare?.morning) ? p.homeCare.morning : [],
            evening: Array.isArray(p.homeCare?.evening) ? p.homeCare.evening : []
          },
          ingredients: Array.isArray(p.ingredients) ? p.ingredients : [],
          warnings: Array.isArray(p.warnings) ? p.warnings : []
        });
      });

      return cleaned;
    }

    // ============================================
    // NAVIGATION
    // ============================================
    function setupNavigation() {
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function () {
          const pageName = this.dataset.page;
          switchPage(pageName);
        });
      });
    }

    function switchPage(pageName) {
      // Update active tab
      document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
      const activeTab = document.querySelector(`[data-page="${pageName}"]`);
      if (activeTab) activeTab.classList.add('active');

      // Update active page
      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));

      const pageMap = {
        'find': 'findPage',
        'library': 'libraryPage',
        'ingredients': 'ingredientsPage',
        'favorites': 'favoritesPage'
      };

      const targetId = pageMap[pageName];
      if (targetId) document.getElementById(targetId).classList.add('active');

      // Refresh content
      if (pageName === 'library') renderLibrary();
      if (pageName === 'favorites') renderFavorites();
    }

    function showOnlyPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(pageId).classList.add('active');
    }

    // ============================================
    // CONDITION SELECTOR
    // ============================================
    function renderConditionGrid() {
      const grid = document.getElementById('conditionGrid');
      grid.innerHTML = SKIN_CONDITIONS.map(condition => `
        <div class="condition-checkbox">
          <input type="checkbox" id="cond-${condition.replace(/\s+/g, '-')}"
                 value="${condition}" onchange="toggleCondition('${escapeQuotes(condition)}')">
          <label for="cond-${condition.replace(/\s+/g, '-')}">${condition}</label>
        </div>
      `).join('');
    }

    function escapeQuotes(s) {
      return String(s).replace(/'/g, "\\'");
    }

    function toggleCondition(condition) {
      const index = selectedConditions.indexOf(condition);
      if (index > -1) selectedConditions.splice(index, 1);
      else selectedConditions.push(condition);
      renderFilteredProtocols();
    }

    function clearAllConditions() {
      selectedConditions = [];
      document.querySelectorAll('.condition-checkbox input').forEach(cb => cb.checked = false);
      renderFilteredProtocols();
    }

    // ============================================
    // PROTOCOL FILTERING & RANKING
    // ============================================
    function renderFilteredProtocols() {
      const resultsDiv = document.getElementById('findResults');

      if (protocols.length === 0) {
        resultsDiv.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìã</div>
            <h3>No Protocols Available</h3>
            <p>Add protocol JSON data directly in this HTML file (EMBEDDED_PROTOCOLS).</p>
          </div>
        `;
        return;
      }

      if (selectedConditions.length === 0) {
        resultsDiv.innerHTML = `
          <div style="background: white; padding: 32px; border-radius: 12px; box-shadow: 0 2px 12px var(--shadow);">
            <h2 style="text-align: center; color: var(--text-light);">
              Select skin conditions above to find matching protocols
            </h2>
            <p style="text-align:center; margin-top: 8px; color: var(--text-light); font-size: 14px;">
              ‚ÄúAll Skin Types‚Äù only shows protocols tagged ‚ÄúAll Skin Types‚Äù when that checkbox is selected.
            </p>
          </div>
        `;
        return;
      }

      const filtered = filterProtocolsByConditions(selectedConditions);
      const filteredCount = protocols.length - filtered.protocols.length;

      if (filtered.protocols.length === 0) {
        resultsDiv.innerHTML = `
          <div class="empty-state">
            <div class="icon">‚ö†Ô∏è</div>
            <h3>No Safe Protocols Found</h3>
            <p>No protocols found for the selected conditions. Some protocols may have contraindications for your selections.</p>
          </div>
        `;
        return;
      }

      let html = `
        <div class="no-print" style="margin-bottom: 16px; display:flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-small" onclick="window.print()">üñ®Ô∏è Print This View</button>
          <button class="btn btn-small btn-secondary" onclick="clearAllConditions()">üßπ Clear Conditions</button>
        </div>
      `;

      html += '<div class="protocol-grid">';

      filtered.protocols.forEach(item => {
        const protocol = item.protocol;
        const matchedConditions = item.matches;
        const isFavorited = isFavorite(protocol.id);

        html += `
          <div class="protocol-card" onclick="viewProtocolDetail('${protocol.id}')">
            <button class="favorite-btn ${isFavorited ? 'favorited' : ''}"
              onclick="event.stopPropagation(); toggleFavorite('${protocol.id}')">
              ${isFavorited ? '‚≠ê' : '‚òÜ'}
            </button>

            <h3>${protocol.name}</h3>

            <div style="margin-bottom: 12px;">
              <span class="badge badge-match">${matchedConditions.length} ${matchedConditions.length === 1 ? 'match' : 'matches'}</span>
            </div>

            <div>
              ${protocol.skinConditions.map(cond =>
                `<span class="badge badge-condition ${matchedConditions.includes(cond) ? 'matched' : ''}">${cond}</span>`
              ).join('')}
            </div>

            ${protocol.contraindications && protocol.contraindications.length > 0
              ? `<div style="margin-top: 12px;"><span class="badge badge-contraindication">‚ö†Ô∏è Has Contraindications</span></div>`
              : ''}
          </div>
        `;
      });

      html += '</div>';

      if (filteredCount > 0) {
        html += `
          <div class="filter-message">
            ‚ÑπÔ∏è ${filteredCount} ${filteredCount === 1 ? 'protocol was' : 'protocols were'} filtered out due to contraindications with your selected conditions
          </div>
        `;
      }

      resultsDiv.innerHTML = html;
    }

    function filterProtocolsByConditions(conditions) {
      const filtered = [];

      protocols.forEach(protocol => {
        // Check for contraindications first
        const hasContraindication = conditions.some(cond =>
          protocol.contraindications && protocol.contraindications.includes(cond)
        );

        if (hasContraindication) return;

        // "All Skin Types" is NOT a wildcard.
        // A protocol matches only if it shares at least one selected condition.
        const matches = protocol.skinConditions.filter(cond => conditions.includes(cond));

        if (matches.length > 0) {
          filtered.push({ protocol, matches, matchCount: matches.length });
        }
      });

      filtered.sort((a, b) => b.matchCount - a.matchCount);

      return { protocols: filtered };
    }

    // ============================================
    // PROTOCOL DETAIL VIEW
    // ============================================
    function viewProtocolDetail(protocolId) {
      const protocol = protocols.find(p => p.id === protocolId);
      if (!protocol) return;

      const detailPage = document.getElementById('detailPage');
      const isFavorited = isFavorite(protocol.id);

      let html = `
        <div class="no-print" style="margin-bottom: 16px; display:flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-small" onclick="backToNavPage()">‚Üê Back</button>
          <button class="btn btn-small btn-secondary" onclick="window.print()">üñ®Ô∏è Print Protocol</button>
          <button class="btn btn-small btn-secondary" onclick="openClientOutput('${protocol.id}')">üë§ Client Output PDF/Print</button>
          <button class="btn btn-small btn-secondary" onclick="shareProtocol('${protocol.id}')">üîó Share Link</button>
        </div>

        <div class="protocol-detail">
          <button class="favorite-btn no-print ${isFavorited ? 'favorited' : ''}"
                  onclick="toggleFavorite('${protocol.id}')">
            ${isFavorited ? '‚≠ê' : '‚òÜ'}
          </button>

          <h1>${protocol.name}</h1>

          <div class="detail-section">
            <h2>Skin Conditions</h2>
            <div>
              ${protocol.skinConditions.map(cond => {
                const isMatched = selectedConditions.includes(cond);
                return `<span class="badge badge-condition ${isMatched ? 'matched' : ''}">${cond}</span>`;
              }).join('')}
            </div>
          </div>

          <div class="detail-section">
            <h2>üì¶ Required Products & Ingredients</h2>
            ${renderIngredientsByCategory(protocol.ingredients || [])}
          </div>

          ${protocol.contraindications && protocol.contraindications.length > 0 ? `
            <div class="contraindication-alert">
              <div class="icon">‚õî</div>
              <div>
                <h2>CONTRAINDICATIONS - DO NOT USE FOR:</h2>
                <ul>
                  ${protocol.contraindications.map(c => `<li>${c}</li>`).join('')}
                </ul>
              </div>
            </div>
          ` : ''}

          ${protocol.warnings && protocol.warnings.length > 0 ? `
            <div class="warning-alert">
              <div class="icon">‚ö†Ô∏è</div>
              <div>
                <h2>WARNINGS</h2>
                <ul>
                  ${protocol.warnings.map(w => `<li>${w}</li>`).join('')}
                </ul>
              </div>
            </div>
          ` : ''}

          <div class="detail-section">
            <h2>üë©‚Äç‚öïÔ∏è Professional Treatment Steps</h2>
            <ol class="steps-list">
              ${(protocol.professionalSteps || []).map(step => `<li>${step}</li>`).join('')}
            </ol>
          </div>

          <div class="detail-section">
            <h2>üè† Home Care Recommendations</h2>
            <div class="homecare-grid">
              <div class="homecare-section">
                <h3>‚òÄÔ∏è Morning Routine</h3>
                <ul>
                  ${(protocol.homeCare?.morning || []).map(step => `<li>${step}</li>`).join('')}
                </ul>
              </div>
              <div class="homecare-section">
                <h3>üåô Evening Routine</h3>
                <ul>
                  ${(protocol.homeCare?.evening || []).map(step => `<li>${step}</li>`).join('')}
                </ul>
              </div>
            </div>
          </div>
        </div>
      `;

      detailPage.innerHTML = html;
      showOnlyPage('detailPage');
    }

    function renderIngredientsByCategory(ingredients) {
      const categories = {
        'Cleansers': [],
        'Toners': [],
        'Treatments': [],
        'Masks': [],
        'Moisturizers': [],
        'Eye Care': [],
        'Sun Protection': [],
        'Other': []
      };

      ingredients.forEach(ingredient => {
        const lower = String(ingredient).toLowerCase();
        if (lower.includes('cleanser')) categories['Cleansers'].push(ingredient);
        else if (lower.includes('toner')) categories['Toners'].push(ingredient);
        else if (lower.includes('mask')) categories['Masks'].push(ingredient);
        else if (lower.includes('moisturizer')) categories['Moisturizers'].push(ingredient);
        else if (lower.includes('eye')) categories['Eye Care'].push(ingredient);
        else if (lower.includes('spf') || lower.includes('protection')) categories['Sun Protection'].push(ingredient);
        else if (lower.includes('serum') || lower.includes('cream') || lower.includes('peel') ||
                 lower.includes('enzyme') || lower.includes('scrub') || lower.includes('pad')) {
          categories['Treatments'].push(ingredient);
        } else categories['Other'].push(ingredient);
      });

      let html = '';
      Object.keys(categories).forEach(category => {
        if (categories[category].length > 0) {
          html += `
            <div class="ingredient-category">
              <h4>${category}</h4>
              <div class="ingredient-grid">
                ${categories[category].map(ing => `<div class="ingredient-item">${ing}</div>`).join('')}
              </div>
            </div>
          `;
        }
      });

      return html || '<p>No ingredients listed</p>';
    }

    function backToNavPage() {
      // Go back to whichever nav tab is active, default to find
      const activeTab = document.querySelector('.nav-tab.active');
      const page = activeTab ? activeTab.dataset.page : 'find';
      switchPage(page);
    }

    // ============================================
    // CLIENT OUTPUT (Printable / PDF)
    // ============================================
    function openClientOutput(protocolId) {
      const protocol = protocols.find(p => p.id === protocolId);
      if (!protocol) return;

      const page = document.getElementById('clientPage');
      const today = new Date().toLocaleDateString();

      // A client-friendly ‚Äúwhat to expect‚Äù section:
      const expectations = inferClientExpectations(protocol);

      page.innerHTML = `
        <div class="no-print" style="margin-bottom: 16px; display:flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn btn-small" onclick="viewProtocolDetail('${protocol.id}')">‚Üê Back to Protocol</button>
          <button class="btn btn-small btn-secondary" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
          <button class="btn btn-small btn-secondary" onclick="shareClientLink('${protocol.id}')">üîó Share Client Link</button>
        </div>

        <div class="protocol-detail">
          <h1 style="margin-bottom: 8px;">Client Aftercare</h1>
          <div style="color: var(--text-light); margin-bottom: 20px;">
            Protocol: <strong>${protocol.name}</strong> ‚Ä¢ Generated: ${today}
          </div>

          <div class="client-meta">
            <div class="field">
              <div class="label">Client Name</div>
              <div class="value">________________________</div>
            </div>
            <div class="field">
              <div class="label">Date</div>
              <div class="value">________________________</div>
            </div>
            <div class="field">
              <div class="label">Notes</div>
              <div class="value">________________________</div>
            </div>
          </div>

          ${protocol.warnings && protocol.warnings.length > 0 ? `
            <div class="warning-alert">
              <div class="icon">‚ö†Ô∏è</div>
              <div>
                <h2>Important Notes</h2>
                <ul>
                  ${protocol.warnings.map(w => `<li>${w}</li>`).join('')}
                </ul>
              </div>
            </div>
          ` : ''}

          <div class="detail-section">
            <h2>‚úÖ What to Expect</h2>
            <ul style="margin-left: 20px;">
              ${expectations.map(x => `<li>${x}</li>`).join('')}
            </ul>
          </div>

          <div class="detail-section">
            <h2>üè† Home Routine</h2>
            <div class="homecare-grid">
              <div class="homecare-section">
                <h3>‚òÄÔ∏è Morning</h3>
                <ul>
                  ${(protocol.homeCare?.morning || []).map(step => `<li>${step}</li>`).join('')}
                </ul>
              </div>
              <div class="homecare-section">
                <h3>üåô Evening</h3>
                <ul>
                  ${(protocol.homeCare?.evening || []).map(step => `<li>${step}</li>`).join('')}
                </ul>
              </div>
            </div>
          </div>

          <div class="detail-section">
            <h2>üß¥ Products Used</h2>
            <div>
              ${(protocol.ingredients || []).map(ing => `<span class="badge badge-condition">${ing}</span>`).join('')}
            </div>
          </div>

          <div class="detail-section">
            <h2>üö´ When to Pause & Contact Your Provider</h2>
            <ul style="margin-left: 20px;">
              <li>Severe swelling, hives, intense burning, blistering, or worsening rash.</li>
              <li>Signs of infection (increasing pain, pus, fever).</li>
              <li>If you‚Äôre unsure whether a product is irritating your skin, stop it and ask your esthetician.</li>
            </ul>
            <p style="margin-top: 10px; color: var(--text-light); font-size: 13px;">
              This handout supports general aftercare and does not replace medical advice.
            </p>
          </div>
        </div>
      `;

      showOnlyPage('clientPage');
      showToast('Client Output ready ‚Äî use Print to save as PDF');
    }

    function inferClientExpectations(protocol) {
      const out = [];

      const name = protocol.name.toLowerCase();
      const hasPeel = (protocol.ingredients || []).some(x => String(x).toLowerCase().includes('peel')) ||
                      name.includes('peel') || name.includes('glycolic') || name.includes('lactic');

      const hasEnzyme = (protocol.ingredients || []).some(x => String(x).toLowerCase().includes('enzyme')) ||
                        name.includes('enzyme');

      if (hasPeel) {
        out.push("Mild dryness or light flaking can happen over the next few days. Follow your routine gently.");
        out.push("Be extra consistent with SPF daily.");
      } else if (hasEnzyme) {
        out.push("Skin may look brighter and feel smoother. Mild pinkness can occur temporarily.");
      } else {
        out.push("You may notice improved hydration, softness, or brightness over the next 24‚Äì48 hours.");
      }

      // If warnings mention flaking/peeling/steam
      const warningText = (protocol.warnings || []).join(' ').toLowerCase();
      if (warningText.includes('flak') || warningText.includes('peel')) {
        out.push("Flaking can be normal. Do not pick or scrub peeling skin.");
      }
      if (warningText.includes('no steam')) {
        out.push("Your treatment avoided steam for a reason‚Äîkeep aftercare gentle and avoid overheating the skin.");
      }

      out.push("Avoid harsh exfoliation unless your esthetician specifically recommended it.");
      out.push("Avoid prolonged heat (hot yoga/sauna/very hot showers) for 24 hours if you‚Äôre feeling sensitive.");

      return out;
    }

    // ============================================
    // LIBRARY PAGE
    // ============================================
    function renderLibrary() {
      const grid = document.getElementById('libraryGrid');

      if (protocols.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="icon">üìö</div>
            <h3>No Protocols Available</h3>
            <p>Add protocol JSON data directly in this HTML file (EMBEDDED_PROTOCOLS).</p>
          </div>
        `;
        return;
      }

      let sorted = [...protocols];
      if (currentSort === 'name') sorted.sort((a, b) => a.name.localeCompare(b.name));
      else if (currentSort === 'conditions') sorted.sort((a, b) => b.skinConditions.length - a.skinConditions.length);

      grid.innerHTML = sorted.map(protocol => {
        const isFavorited = isFavorite(protocol.id);
        return `
          <div class="protocol-card" onclick="viewProtocolDetail('${protocol.id}')">
            <button class="favorite-btn ${isFavorited ? 'favorited' : ''}"
                    onclick="event.stopPropagation(); toggleFavorite('${protocol.id}')">
              ${isFavorited ? '‚≠ê' : '‚òÜ'}
            </button>
            <h3>${protocol.name}</h3>
            <div>
              ${protocol.skinConditions.map(cond => `<span class="badge badge-condition">${cond}</span>`).join('')}
            </div>
            ${protocol.contraindications && protocol.contraindications.length > 0
              ? `<div style="margin-top: 12px;"><span class="badge badge-contraindication">‚ö†Ô∏è Has Contraindications</span></div>`
              : ''}
          </div>
        `;
      }).join('');
    }

    function sortLibrary(sortType) {
      currentSort = sortType;
      renderLibrary();
    }

    // ============================================
    // INGREDIENT SEARCH
    // ============================================
    function populateIngredientDropdown() {
      const select = document.getElementById('ingredientSelect');
      if (!select) return;

      const allIngredients = new Set();
      protocols.forEach(protocol => (protocol.ingredients || []).forEach(ing => allIngredients.add(ing)));

      const sorted = Array.from(allIngredients).sort((a, b) => String(a).localeCompare(String(b)));

      select.innerHTML = '<option value="">‚Äì Select an ingredient ‚Äì</option>' +
        sorted.map(ing => `<option value="${escapeHtml(String(ing))}">${escapeHtml(String(ing))}</option>`).join('');
    }

    function filterByIngredient() {
      const select = document.getElementById('ingredientSelect');
      const ingredient = select.value;
      const resultsDiv = document.getElementById('ingredientResults');

      if (!ingredient) { resultsDiv.innerHTML = ''; return; }

      const filtered = protocols.filter(p => (p.ingredients || []).includes(ingredient));

      if (filtered.length === 0) {
        resultsDiv.innerHTML = `
          <div class="empty-state">
            <div class="icon">üîç</div>
            <h3>No Protocols Found</h3>
            <p>No protocols found with ${escapeHtml(ingredient)}</p>
          </div>
        `;
        return;
      }

      resultsDiv.innerHTML = `
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 12px var(--shadow); margin-bottom: 24px;">
          <h3>${filtered.length} ${filtered.length === 1 ? 'protocol' : 'protocols'} found with <strong>${escapeHtml(ingredient)}</strong></h3>
        </div>
        <div class="protocol-grid">
          ${filtered.map(protocol => {
            const isFavorited = isFavorite(protocol.id);
            return `
              <div class="protocol-card" onclick="viewProtocolDetail('${protocol.id}')">
                <button class="favorite-btn ${isFavorited ? 'favorited' : ''}"
                        onclick="event.stopPropagation(); toggleFavorite('${protocol.id}')">
                  ${isFavorited ? '‚≠ê' : '‚òÜ'}
                </button>
                <h3>${protocol.name}</h3>
                <div>
                  ${protocol.skinConditions.map(cond => `<span class="badge badge-condition">${cond}</span>`).join('')}
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    // ============================================
    // FAVORITES
    // ============================================
    function getFavorites() {
      const stored = localStorage.getItem('favoriteProtocols');
      try { return stored ? JSON.parse(stored) : []; }
      catch { return []; }
    }

    function saveFavorites(favorites) {
      localStorage.setItem('favoriteProtocols', JSON.stringify(favorites));
    }

    function isFavorite(protocolId) {
      return getFavorites().includes(protocolId);
    }

    function toggleFavorite(protocolId) {
      const favorites = getFavorites();
      const index = favorites.indexOf(protocolId);

      if (index > -1) {
        favorites.splice(index, 1);
        showToast('Removed from favorites');
      } else {
        favorites.push(protocolId);
        showToast('Added to favorites ‚≠ê');
      }

      saveFavorites(favorites);

      // Refresh visible pages
      renderFavorites();
      renderLibrary();
      // If detail page is open, re-render it to update star state
      const detailActive = document.getElementById('detailPage').classList.contains('active');
      if (detailActive) viewProtocolDetail(protocolId);
    }

    function renderFavorites() {
      const grid = document.getElementById('favoritesGrid');
      const favorites = getFavorites();
      const favoriteProtocols = protocols.filter(p => favorites.includes(p.id));

      if (favoriteProtocols.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="icon">‚≠ê</div>
            <h3>No Favorite Protocols Yet</h3>
            <p>Click the star icon on any protocol to save it here</p>
          </div>
        `;
        return;
      }

      grid.innerHTML = favoriteProtocols.map(protocol => `
        <div class="protocol-card" onclick="viewProtocolDetail('${protocol.id}')">
          <button class="favorite-btn favorited"
                  onclick="event.stopPropagation(); toggleFavorite('${protocol.id}')">
            ‚≠ê
          </button>
          <h3>${protocol.name}</h3>
          <div>
            ${protocol.skinConditions.map(cond => `<span class="badge badge-condition">${cond}</span>`).join('')}
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // SHARE LINKS
    // ============================================
    function shareProtocol(protocolId) {
      const protocol = protocols.find(p => p.id === protocolId);
      if (!protocol) return;

      const shareText = `Skin protocol: ${protocol.name}`;
      const base = window.location.href.split('?')[0];
      const shareUrl = base + '?protocol=' + encodeURIComponent(protocolId);

      if (navigator.share) {
        navigator.share({ title: protocol.name, text: shareText, url: shareUrl })
          .catch(() => {});
      } else {
        navigator.clipboard.writeText(shareUrl).then(() => showToast('Link copied to clipboard!'));
      }
    }

    function shareClientLink(protocolId) {
      const protocol = protocols.find(p => p.id === protocolId);
      if (!protocol) return;

      const base = window.location.href.split('?')[0];
      const shareUrl = base + '?client=' + encodeURIComponent(protocolId);

      if (navigator.share) {
        navigator.share({ title: protocol.name + ' (Client Output)', text: 'Client aftercare handout', url: shareUrl })
          .catch(() => {});
      } else {
        navigator.clipboard.writeText(shareUrl).then(() => showToast('Client link copied to clipboard!'));
      }
    }

    // ============================================
    // UTILITIES
    // ============================================
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // ============================================
    // URL ROUTING ON LOAD
    // ============================================
    window.addEventListener('load', function () {
      const urlParams = new URLSearchParams(window.location.search);
      const protocolId = urlParams.get('protocol');
      const clientId = urlParams.get('client');

      if (clientId && protocols.find(p => p.id === clientId)) {
        openClientOutput(clientId);
        return;
      }

      if (protocolId && protocols.find(p => p.id === protocolId)) {
        viewProtocolDetail(protocolId);
      }
    });
  </script>
</body>
</html>
